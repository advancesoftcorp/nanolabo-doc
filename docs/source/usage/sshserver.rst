.. _sshserver:

=====================================
SSHサーバーの設定
=====================================

画面左上のアイコン |mainmenuicon| から :menuselection:`Network --> SSH server` を開きます。

.. |mainmenuicon| image:: /img/mainmenuicon.png

.. image:: /img/sshserver.png
   :width: 350 px

サーバーの追加
-------------------------

サーバーを追加するには、:guilabel:`SSH Configuration` の右側の |add| ボタンをクリックし、分かりやすい名前を付けて :guilabel:`OK` をクリックします。リストに名前が表示されますので、以降このサーバーの設定をしていきます。設定内容は自動的に保存されます。

.. |add| image:: /img/add.png

.. note::

   リストにはあらかじめ `FOCUSスパコン <https://www.j-focus.or.jp/>`_ 用の設定例「FOCUS」が入っています。FOCUSスパコンへのジョブ投入を行う場合は、リストで「FOCUS」を選択し、設定していただくと簡単です。

Serverタブの設定
-------------------------

:guilabel:`Server` タブで、サーバーへの接続に関する設定を行います。

- Host Name
- Port
   サーバーのホスト名（またはIPアドレス）、ポート番号を入力します。

- Job Manager
   サーバーで使われているジョブ管理システムを選択します。PBS、SLURMに対応しています。Rawを選択すると、ジョブ管理システムを使わずに直接計算を実行します。

   .. warning::

      通常、ジョブ管理システムを導入しているサーバーでは、計算の直接実行は想定されていません。サーバーの管理者に確認した上で設定してください。

- Work Directory
   計算で使用するファイルの転送先（サーバー上のディレクトリパス）を入力します。書き込み権限のある場所を指定してください。通常、ユーザーのホームディレクトリを指定すれば問題ありません。

- HTTP Proxy
   サーバーへの接続にプロキシを使用します(SSH over HTTP)。 :menuselection:`Network --> Proxy server` で設定したプロキシが使われます。インターネットへの接続にプロキシが必要な環境で、外部のクラウド仮想マシン等に計算ジョブを投入する際にお使いいただけます。

- Account
   サーバーにSSH接続する際のアカウント情報を入力します。認証の方式により、秘密鍵ファイルまたはパスワードを設定してください。

設定内容に問題がなければ、タブが白色になります。問題がある場合はその項目が赤色で表示されますので、確認してください。

Jobタブの設定
------------------------

次に、 :guilabel:`Job` タブでサーバーへのジョブ投入に関する設定を行います。

- Job Queue
   キューの名前のリストです。 |add| ボタンで追加、 |remove| ボタンで削除します。
   ジョブ管理システムを使わずに実行する場合でも、適当な名前のキューを作成してください。

.. |remove| image:: /img/remove.png

- Job Posting Command
- Job Script
   キューごとに、ジョブ投入用のコマンドとジョブスクリプトを設定します。ジョブ管理システムに応じたデフォルトの内容がキュー追加時に設定されます。必要に応じて編集してください。
   
   .. note::

      実際に実行されるスクリプトの内容は、ジョブ投入時に表示されるウィンドウでご確認ください。

Speedタブの設定
------------------------

:guilabel:`Speed` タブでは、サーバーからの情報取得・ファイルダウンロードの間隔、同時接続数を設定できます。

サーバーへのアクセス頻度が問題になる場合には、スライダーを :guilabel:`Slow` 側に動かすことで頻度を下げることができます。

:guilabel:`Connection Style` で、低速ネットワーク用の設定ができます。

 - Online Mode
    常時オフラインモードに設定すると、リアルタイムでの結果取得（ファイルのダウンロード）を行いません。
 
 - Download Mode
    容量の大きいバイナリファイルなどを除外し、テキストファイルのみダウンロードするよう設定できます。

 - Download Time
    常時オフラインモードの際に、ファイルを一括ダウンロードする間隔（分単位）を設定します。

サーバーの編集・削除
-------------------------

各タブで設定した内容は、サーバーごとに保存されます。リストから既に保存されているサーバーを選択すると、その設定内容を編集できます。

サーバーを削除するには、:guilabel:`SSH Configuration` の右側の |remove| ボタンをクリックしてください。